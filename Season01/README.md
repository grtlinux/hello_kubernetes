
# Hello Kubernetes Season 01

- [Ep01. Setup Kubernetes Cluster using kubeadm on CentOS 7](https://github.com/grtlinux/hello_kubernetes/blob/master/Season01/Ep01/README.md)
- [Ep02. Setup Kubernetes Cluster with Vagrant](https://github.com/grtlinux/hello_kubernetes/blob/master/Season01/Ep02/README.md)
- [Ep03. Kubernetes single node cluster using microk8s](https://github.com/grtlinux/hello_kubernetes/blob/master/Season01/Ep03/README.md)
- [Ep04. Single node Kubernetes Cluster with Minikube](https://github.com/grtlinux/hello_kubernetes/blob/master/Season01/Ep04/README.md)
- [Ep05. Install Kubernetes Dashboard Web UI](https://github.com/grtlinux/hello_kubernetes/blob/master/Season01/Ep05/README.md)
- [Ep06. Running Docker Containers in Kubernetes Cluster](https://github.com/grtlinux/hello_kubernetes/blob/master/Season01/Ep06/README.md)
- [Ep07. Kubernetes Pods Replicasets & Deployments](https://github.com/grtlinux/hello_kubernetes/blob/master/Season01/Ep07/README.md)
- [Ep08. Kubernetes Namespaces & Contexts](https://github.com/grtlinux/hello_kubernetes/blob/master/Season01/Ep08/README.md)
- [Ep09. How to use Node Selector in Kubernetes](https://github.com/grtlinux/hello_kubernetes/blob/master/Season01/Ep09/README.md)
- [Ep10. Kubernetes DaemonSets](https://github.com/grtlinux/hello_kubernetes/blob/master/Season01/Ep10/README.md)
- [Ep11. Jobs & Cronjobs in Kubernetes Cluster](https://github.com/grtlinux/hello_kubernetes/blob/master/Season01/Ep11/README.md)
- [Ep12. Init Containers in Kubernetes Cluster](https://github.com/grtlinux/hello_kubernetes/blob/master/Season01/Ep12/README.md)
- [Ep13. Using Persistent Volumes and Claims in Kubernetes Cluster](https://github.com/grtlinux/hello_kubernetes/blob/master/Season01/Ep13/README.md)
- [Ep14. Using Secrets in Kubernetes](https://github.com/grtlinux/hello_kubernetes/blob/master/Season01/Ep14/README.md)
- [Ep15. Using ConfigMaps in Kubernetes Cluster](https://github.com/grtlinux/hello_kubernetes/blob/master/Season01/Ep15/README.md)
- [Ep16. Using Resource Quotas & Limits in Kubernetes Cluster](https://github.com/grtlinux/hello_kubernetes/blob/master/Season01/Ep16/README.md)
- [Ep17. Renaming Kubernetes Nodes](https://github.com/grtlinux/hello_kubernetes/blob/master/Season01/Ep17/README.md)
- [Ep18. How to setup Rancher to manage your Kubernetes Cluster](https://github.com/grtlinux/hello_kubernetes/blob/master/Season01/Ep18/README.md)
- [Ep19. Performing Rolling Updates in Kubernetes](https://github.com/grtlinux/hello_kubernetes/blob/master/Season01/Ep19/README.md)
- [Ep20. NFS Persistent Volume in Kubernetes Cluster](https://github.com/grtlinux/hello_kubernetes/blob/master/Season01/Ep20/README.md)
- [Ep21. How to use Statefulsets in Kubernetes Cluster](https://github.com/grtlinux/hello_kubernetes/blob/master/Season01/Ep21/README.md)
- [Ep22. How to upgrade your Kubernetes Cluster](https://github.com/grtlinux/hello_kubernetes/blob/master/Season01/Ep22/README.md)
- [Ep23. Dynamically provision NFS persistent volumes in Kubernetes](https://github.com/grtlinux/hello_kubernetes/blob/master/Season01/Ep23/README.md)
- [Ep24. Getting started with Helm in Kubernetes Cluster](https://github.com/grtlinux/hello_kubernetes/blob/master/Season01/Ep24/README.md)

```
        *[Kube 7] Kubernetes Pods Replicasets & Deployments
        *[Kube 8] Kubernetes Namespaces & Contexts
        *[Kube 9] How to use Node Selector in Kubernetes
        *[Kube 9.1] PodNodeSelector Admission Control Plugin | Assigning pods to nodes
        *[Kube 10] Kubernetes DaemonSets
        *[Kube 11] Jobs & Cronjobs in Kubernetes Cluster
        *[Kube 11.1] Deleting Jobs in Kubernetes after completion using feature gate TTLAfterFinished
        *[Kube 12] Init Containers in Kubernetes Cluster
        *[Kube 13] Using Persistent Volumes and Claims in Kubernetes Cluster
        *[Kube 14] Using Secrets in Kubernetes
        *[Kube 15] Using ConfigMaps in Kubernetes Cluster
        *[Kube 16] Using Resource Quotas & Limits in Kubernetes Cluster
        *[Kube 17] Renaming Kubernetes Nodes
        *[Kube 18] How to setup Rancher to manage your Kubernetes Cluster
        *[Kube 18 Discussion 1] Rancher issues with Calico
        *[Kube 18.1] Monitoring Kubernetes Cluster with Rancher v2
        *[Kube 18.2] Kubernetes Logging with Rancher, Fluentd and Elastic Stack
        *[Kube 19] Performing Rolling Updates in Kubernetes
        *[Kube 20] NFS Persistent Volume in Kubernetes Cluster
        *{Kube 21] How to use Statefulsets in Kubernetes Cluster
        *[Kube 22] How to upgrade your Kubernetes Cluster
        *[Kube 23] Dynamically provision NFS persistent volumes in Kubernetes
        *[Kube 24] Getting started with Helm in Kubernetes Cluster
        *[Kube 24 Discussion 1] How to make Helm work with Kubernetes v1.16
        *[Kube 24.1] Helm v3.0 released | How to migrate from v2
        *[Kube 25] Running Jenkins in Kubernetes Cluster using Helm
        *[Kube 25 Discussion 1] Configuring Jenkins to connect to Kubernetes cluster
        *[Kube 26] Prometheus monitoring for Kubernetes Cluster and Grafana visualization
         [Kube 27 GKE 1] Using gcloud CLI and Google Cloud Console
         [Kube 28 GKE 2] Creating your first Kubernetes cluster in GKE
         [Kube 29 GKE 3] Deploying an app in GKE Cluster
        *[Kube 30] Deploying Kubernetes Cluster using LXC Containers
        *[Kube 30.1] Kubernetes 1.17 on LXC Containers
        *[Kube 31] Set up Nginx Ingress in Kubernetes Bare Metal       (haproxy)
        *[Kube 32] Set up Traefik Ingress on kubernetes Bare Metal Cluster
        *[Kube 33] Set up MetalLB Load Balancing for Bare Metal Kubernetes
        *[Kube 34] Monitor Kubernetes Logs using EFK stack - Elasticsearch, FluentBit & Kibana
        *[Kube 34 Discussion 1] Customizing EFK Deployment in Kubernetes using Rancher
        *[Kube 35] Using Horizontal Pod Autoscaler in Kubernetes
        *[Kube 35 Discussion 1] Pod auto-scaling based on memory utilization
        *[Kube 35.1] Deploying metrics-server in Kubernetes using Helm
        *[Kube 36] Useful Kubernetes Tools - kube-ops-view and kubebox
        *[Kube 37] Setup Lets Encrypt cert-manager in Kubernetes Bare Metal
        *[Kube 38] Kubernetes The Hard Way - Part 1
        *[Kube 39] Kubernetes The Hard Way - Part 2
        *[Kube 40] Kubernetes The Hard Way HA Testing
        *[Kube 41] Deploying NextCloud in Kubernetes
```


---

# Install Kubernetes Cluster using kubeadm
Follow this documentation to set up a Kubernetes cluster on __CentOS 7__ Virtual machines.

This documentation guides you in setting up a cluster with one master node and one worker node.

## Assumptions
|Role|FQDN|IP|OS|RAM|CPU|
|----|----|----|----|----|----|
|Master|kmaster.example.com|172.42.42.100|CentOS 7|2G|2|
|Worker|kworker.example.com|172.42.42.101|CentOS 7|1G|1|

## On both Kmaster and Kworker
Perform all the commands as root user unless otherwise specified
### Pre-requisites
##### Update /etc/hosts
So that we can talk to each of the nodes in the cluster
```
cat >>/etc/hosts<<EOF
172.42.42.100 kmaster.example.com kmaster
172.42.42.101 kworker.example.com kworker
EOF
```
##### Install, enable and start docker service
Use the Docker repository to install docker.
> If you use docker from CentOS OS repository, the docker version might be old to work with Kubernetes v1.13.0 and above
```
yum install -y -q yum-utils device-mapper-persistent-data lvm2 > /dev/null 2>&1
yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo > /dev/null 2>&1
yum install -y -q docker-ce >/dev/null 2>&1

systemctl enable docker
systemctl start docker
```
##### Disable SELinux
```
setenforce 0
sed -i --follow-symlinks 's/^SELINUX=enforcing/SELINUX=disabled/' /etc/sysconfig/selinux
```
##### Disable Firewall
```
systemctl disable firewalld
systemctl stop firewalld
```
##### Disable swap
```
sed -i '/swap/d' /etc/fstab
swapoff -a
```
##### Update sysctl settings for Kubernetes networking
```
cat >>/etc/sysctl.d/kubernetes.conf<<EOF
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
EOF
sysctl --system
```
### Kubernetes Setup
##### Add yum repository
```
cat >>/etc/yum.repos.d/kubernetes.repo<<EOF
[kubernetes]
name=Kubernetes
baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64
enabled=1
gpgcheck=1
repo_gpgcheck=1
gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg
        https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
EOF
```
##### Install Kubernetes
```
yum install -y kubeadm kubelet kubectl
```
##### Enable and Start kubelet service
```
systemctl enable kubelet
systemctl start kubelet
```
## On kmaster
##### Initialize Kubernetes Cluster
```
kubeadm init --apiserver-advertise-address=172.42.42.100 --pod-network-cidr=192.168.0.0/16
```
##### Copy kube config
To be able to use kubectl command to connect and interact with the cluster, the user needs kube config file.

In my case, the user account is venkatn
```
mkdir /home/venkatn/.kube
cp /etc/kubernetes/admin.conf /home/venkatn/.kube/config
chown -R venkatn:venkatn /home/venkatn/.kube
```
##### Deploy Calico network
This has to be done as the user in the above step (in my case it is __venkatn__)
```
kubectl create -f https://docs.projectcalico.org/v3.11/manifests/calico.yaml
```

##### Cluster join command
```
kubeadm token create --print-join-command
```
## On Kworker
##### Join the cluster
Use the output from __kubeadm token create__ command in previous step from the master server and run here.

## Verifying the cluster
##### Get Nodes status
```
kubectl get nodes
```
##### Get component status
```
kubectl get cs
```

Have Fun!!
